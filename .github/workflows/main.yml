name: è‡ªåŠ¨å‘å¸ƒç›´æ’­æº
on:
  # è§¦å‘æ—¶æœºï¼šç›´æ’­æºæ›´æ–°å·¥ä½œæµå®Œæˆåè§¦å‘ï¼ˆéœ€æ›¿æ¢ä¸ºä½ çš„æ›´æ–°å·¥ä½œæµåç§°ï¼‰
  workflow_run:
    workflows: ["livesource.yml"]  # ä½ çš„ç›´æ’­æºæ›´æ–°å·¥ä½œæµåç§°
    types:
      - completed

jobs:
  release:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}  # ä»…å½“æ›´æ–°æˆåŠŸæ—¶è§¦å‘
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          ref: main  # å‘å¸ƒmainåˆ†æ”¯çš„æœ€æ–°ä»£ç 

      - name: æ‰“åŒ…ç›´æ’­æºæ–‡ä»¶
        run: |
          # æ‰“åŒ…outputç›®å½•ä¸‹çš„full.txt
          zip -j live-source-full-${{ github.run_id }}.zip output/full.txt
          # ç”Ÿæˆç‰ˆæœ¬å·ï¼ˆæŒ‰æ—¥æœŸ+è¿è¡ŒIDï¼‰
          VERSION="v$(date +%Y%m%d)-${{ github.run_id }}"

      - name: åˆ›å»ºè‡ªåŠ¨Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ env.VERSION }}  # è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬å·
          release_name: "ç›´æ’­æºæ›´æ–°_${{ env.VERSION }}"
          body: |
            ğŸ“… æ›´æ–°æ—¶é—´ï¼š${{ github.event.head_commit.timestamp }}
            ğŸ“¦ åŒ…å«æ–‡ä»¶ï¼šoutput/full.txtï¼ˆæœ€æ–°å®Œæ•´ç›´æ’­æºï¼‰
          files: live-source-full-${{ github.run_id }}.zip  # ä¸Šä¼ æ‰“åŒ…æ–‡ä»¶
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # GitHubè‡ªåŠ¨æä¾›çš„æƒé™ä»¤ç‰Œ
